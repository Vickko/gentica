# 架构设计

## 设计基础
- 参考DeepAgents的agent四要素模型
- 借鉴事件驱动混合模型的架构特点
- 结合TRPG游戏性特点进行设计

## 核心Agent组件

### 1. 认知沟通切面Agent（跑团主持人/认知核心）

#### 职责
- 筛选和展示世界事件给用户
- 避免世界模型直接与用户沟通，降低上下文干扰
- 管理用户视角与世界视角的转换

#### 特殊考虑
- 在有明确剧情大纲的场景下，可能需要额外的agent主持
- 与世界模型紧密沟通配合，监督剧情发展走向

### 2. 世界模型（事件总线）

#### 核心功能
- 维护世界总体的客观事件总和
- 拥有完全的上帝视角（不包含主观内容如角色内心想法）

#### 管理内容
- 角色移动轨迹（从哪个场景到哪个场景）
- 角色行为记录
- 世界物体的客观变动（如：门被撞坏、箱子被打开）
- 任何非主观且有实际展现的内容

#### 潜在优化
- 考虑细分事件总线子agent，过滤海量事件避免影响认知

### 3. 角色-世界交互-感知Heartbeat Agent

#### 设计理念
- 驱动连贯的意识需要自循环运转能力
- 需要来自感官的外界信息/信号刺激

#### 主要功能
- 在无事件时驱动角色意识运转
- 充当角色感官系统
- 分析筛选来自世界模型的信息
- 基于角色当前环境和事件，提供角色能感知到的客观但片面的信息

#### 感知维度
- 视觉、听觉、嗅觉等各种感官信息
- 环境信息和事件信息

### 4. 角色Agent（表意识）

#### 设计特点
- LLM的chat承担角色的思考/心声
- 通过heartbeat message驱动连贯意识
- 说话作为动作之一，通过tool call驱动（人不是无时不刻在讲话）

#### 交互设计
- 设计一套tool call系统：移动()、吃饭()等
- 可能的替代方案：通过chat中的xml/json标签区分思考和说话

### 5. 角色潜意识Agent（与底层Memory Bank交互）

#### 设计目的
- 减轻表意识的上下文干扰和心智负担

#### 特性
- 与表意识共享上下文（或类似机制）
- 目的与表意识不同
- 极少或非常克制地与表意识直接交流

#### 功能
- 类似传统agent四要素中的file system tool call设计
- 直接负责具体的memory管理和记录工作

## 系统运行机制

### STW (Stop The World) 机制
- **触发条件**：仅在用户决策/发言时
- **不触发情况**：
  - 用户观看时
  - 用户常规思考时
  - 世界以其自身意志运转

## 核心设计思想

**认知与执行分离**
- 目标：达成有鲁棒性的、用户输入无关的世界自主运转
- 实现：通过多层agent分离不同认知和执行职责