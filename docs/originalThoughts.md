### 关于目标

首先最终目标有两个，

一是,我打算使用**多llm
agent范式**构建一个**TRPG系统**，

预期效果:
- 仅需描述世界观和给出主要人物设定等必要内容就可以建立一个精彩、逻辑上真实可信的虚拟世界，
- 极大程度上可以脱离用户输入运转，
- 角色会自主行动影响世界、有自己的记忆和决断、主观
意志和偏好、不死板不样板。

二是，在这个路上或是目标一完成的事后，

希望提炼出一套**中性的、凝练架构设计和方法论的多agents框架**，

这套多agents系统目标是：
- 可以在多种复杂的、需要涌现能力的场景都提炼出相当多的共性以供复用，
- 且在这些场景下都可以在尽可能少量的修改和定制下
就能展现极高的适应性和表现质量。

### 实现思路

目前实现思路是借鉴已有的一些**llm 多agents系统**，

不限于一定要是general purpose的，而是可以大量从为特定任务目的设计的多agents系统汲取灵感和分析以提炼可以让系统体现出高智能的关键共性设计，

- 最典型但包括且不限于的就是以Claude
Code为代表
- 和受其启发衍生出的的一众Coding agents，
- 还有langchain/deepagents提出的agent范式与四要素，
- 还有一些文章中提到的单体线性循环-层级式委托-多体协作-事
件驱动混合模型等，

这些都是目前我已经找到的有高借鉴意义的内容，也许时机合适还可以再拓展思路和具体场景
找一些额外的启发性内容。

具体实现上，考虑到我（项目发起者）的惯用技术栈，同时权衡了参考内容的已有代码质量和节省快速原型开发时间的目的，打算极大程度上参考
`charmbracelet/crush`这个项目的一些具体模块实现拿来复用，甚至以此为基础直接在上面进行改动和二次开发。

### 架构设计（TRPG特化部分）（草案）

我主要参考了DeepAgents提出的agent四要素模型和事件驱动混合模型的架构特点，结合了TRPG游戏性的特点，构想了以下架构设计：

Tips: 首先这套设计的核心思想在于"认知与执行分离"，以达成有鲁棒性的、用户输入无关的世界自主运转
Tips: 作为特征性表现，用户决策/发言时会STW (Stop The World)，反之则不会，包括用户观看和常规思考时都不会，世界以其自身意志运转

**（用户）认知沟通切面agent（跑团主持人/认知核心？）**：
> 由于系统是自运转的，不依赖用户输入驱动，世界上发生的所有事情也不一定都是用户操纵的角色可感知的。
> 因此在上帝视角下的世界模型中不断发生的各种event需要有选择性地筛选展示给用户，
> 并且应该避免让世界模型直接与用户沟通以降低各自的上下文干扰。
> 需要考虑对于有明确剧情大纲的场景下是否需要额外的agent主持并与世界模型紧密沟通和配合，监督剧情发展走向

**世界模型（事件总线？）**：
> 维护世界总体的客观事件总和，
> 拥有完全的上帝视角（但不包含完全主观的内容比如角色内心想法）
> （这里是否需要再细分一类子agent，即事件总线，以过滤海量事件避免影响认知？）,
> 什么角色从哪个场景移动到哪个场景做了什么，
> 是否有世界物体受到了客观变动、什么变动（例如x角色撞坏了一扇门、打开了一个箱子），
> 任何非主观且有实际展现的内容


**角色-世界交互-感知heartbeat agent**：
> 首先依据下文角色agent需求，驱动连贯的意识需要自循环的运转能力，同时需要来自感官的外界信息/信号刺激。
> 那么这个agent首先需要在即便没什么事的情况下驱动角色意识运转，
> 其次充当其感官，分析并筛选来自世界模型的、角色所处当前环境和事件下，角色所能感知到的客观但片面的信息，包括声光味等各种角色能获取信息的维度，
> 将这些内容提供给角色agent以驱动角色运转。

**角色agent（表意识）**：
> 常规认知中最应该是角色agent的那个部分。
> 不同的是（暂时的思考，还有可能推翻），
> llm的chat应该承担这个角色的思考/心声，
> 通过前者的heartbeat message驱动连贯的意识，而chat应该作为动作之一，通过tool call驱动，毕竟一个人也不是无时不刻在讲话的。
> （或者还有可能的思路是通过chat中的xml/json等标签区分思考和说话，但这也互有优劣）
> 同样地，顺着这种思路，角色与世界交互的行动等同样应当设计一套类似移动()、吃饭()的一组tool call来完成

**角色潜意识agent(与底层Memory bank等交互）**：
> 同样是为了减轻表意识上下文干扰和跳戏/心智负担而分离的agent。
> 目前的想法是它与表意识共享上下文（或者类似），而目的不同。
> 目前来看表意识和潜意识不需要或者应该极少/非常克制地互相直接交流。
> 它拥有传统agent四要素中与file system更类似的tool call设计，直接负责具体的memory管理和记录等工作
